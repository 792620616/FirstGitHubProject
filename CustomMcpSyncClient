package com.xiao.mcpclient.config;


import io.modelcontextprotocol.client.McpClient;
import io.modelcontextprotocol.client.McpSyncClient;
import io.modelcontextprotocol.client.transport.WebFluxSseClientTransport;
import io.modelcontextprotocol.spec.McpClientTransport;
import io.modelcontextprotocol.spec.McpSchema;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.ai.mcp.client.autoconfigure.McpClientAutoConfiguration;
import org.springframework.ai.mcp.client.autoconfigure.NamedClientMcpTransport;
import org.springframework.ai.mcp.client.autoconfigure.properties.McpSseClientProperties;
import org.springframework.beans.factory.annotation.Configurable;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Component;
import org.springframework.web.reactive.function.client.WebClient;

import java.time.Duration;
import java.util.List;

@Component
public class CustomMcpSyncClient {

    private static final Logger logger = LoggerFactory.getLogger(CustomMcpSyncClient.class);

    /**
     * 自定义 WebClient，添加日志过滤器等。
     * Spring Boot 会自动提供一个 WebClient.Builder，我们在此基础上进行定制。
     */
    @Bean("mcpWebClient")
    public McpSyncClient mcpWebClient(WebClient.Builder builder) {
        WebClient.Builder basedUrl = builder.baseUrl("http://localhost:8080");
        WebFluxSseClientTransport tbura = WebFluxSseClientTransport.builder(basedUrl).build();
        NamedClientMcpTransport namedClientMcpTransport = new NamedClientMcpTransport("xiaojunjie", tbura);
        McpSchema.Implementation clientInfo = new McpSchema.Implementation("mcpClient", "1.0.0");
        McpClient.SyncSpec spec = McpClient.sync(namedClientMcpTransport.transport()).clientInfo(clientInfo).requestTimeout(Duration.ofSeconds(20));
       // spec = mcpSyncClientConfigurer.configure(namedTransport.name(), spec);
        McpSyncClient client = spec.build();
        return client;
    }


}
